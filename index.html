<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AniStream Player | Design Avançado e WebTorrent</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/webtorrent/latest/webtorrent.min.js"></script>
    
    <style>
        /* =================================================================
           # PALETA DE CORES E VARIÁVEIS
           ================================================================= */
        :root {
            --primary: #00e676;         /* Verde Neon para Ação e Progresso */
            --secondary: #ff3d00;       /* Laranja/Vermelho para Busca/Foco */
            --blue-accent: #00b0ff;     /* Azul Vibrante para Foco Secundário */
            --bg-dark: #121212;         /* Fundo escuro principal */
            --bg-medium: #282828;       /* Fundo de cards/controles */
            --bg-light: #3a3a3a;        /* Borda/Hover de controles */
            --text-light: #e0e0e0;      /* Texto principal */
            --text-muted: #b0b0b0;      /* Texto secundário/ícones desativados */
            --hover-color: rgba(255, 255, 255, 0.1);
        }

        /* =================================================================
           # RESET E BASE
           ================================================================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Alinha o conteúdo ao topo */
            min-height: 100vh;
            padding: 20px;
        }

        /* =================================================================
           # CONTAINER PRINCIPAL
           ================================================================= */
        .player-container {
            width: 100%;
            max-width: 900px;
            background-color: var(--bg-medium);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        /* =================================================================
           # ÁREA DO VÍDEO E PLAYER
           ================================================================= */
        .video-wrapper {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9; /* Padrão 16:9 */
            background-color: #000;
            overflow: hidden;
        }

        .video-wrapper.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            aspect-ratio: auto;
        }

        #nativeVideo {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: contain; /* Garante que o vídeo se encaixe */
        }

        /* =================================================================
           # CONTROLES DO PLAYER
           ================================================================= */
        .controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0));
            padding: 10px 15px;
            transition: opacity 0.3s ease;
            opacity: 1;
            display: flex;
            flex-direction: column;
            pointer-events: none; /* Permite cliques através */
        }

        .video-wrapper:hover .controls,
        .controls.active {
            opacity: 1;
            pointer-events: auto; /* Reativa cliques */
        }

        /* Barra de Progresso (Seekbar) */
        .progress-bar-container {
            height: 8px;
            background: var(--bg-medium);
            border-radius: 4px;
            margin-bottom: 8px;
            cursor: pointer;
            position: relative;
            pointer-events: auto;
        }

        .progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: var(--primary);
            border-radius: 4px;
            transition: width 0.1s linear;
        }

        .progress-bar-container:hover .progress-bar {
            height: 100%;
        }

        /* Controles Inferiores (Botões e Tempo) */
        .controls-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .controls-left, .controls-right {
            display: flex;
            align-items: center;
        }
        
        /* Botões de Controle */
        .control-btn {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background-color: var(--hover-color);
        }

        .material-icons {
            font-size: 24px;
            user-select: none;
        }

        .volume-control {
            display: flex;
            align-items: center;
            margin: 0 10px;
        }

        .volume-control input[type="range"] {
            -webkit-appearance: none;
            height: 4px;
            background: var(--text-muted);
            border-radius: 2px;
            cursor: pointer;
            width: 80px;
            margin: 0 5px;
        }

        .volume-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }

        /* Display de Tempo */
        .time-display {
            font-size: 14px;
            margin: 0 15px;
            min-width: 90px;
            text-align: center;
            color: var(--text-light);
        }
        
        /* Status do WebTorrent */
        #torrent-status {
            font-size: 12px;
            color: var(--text-muted);
            margin-left: 20px;
            display: flex;
            gap: 15px;
            min-width: 150px;
            justify-content: flex-start;
        }
        
        #torrent-status .status-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        #torrent-status .material-icons {
            font-size: 16px;
            opacity: 0.8;
        }


        /* =================================================================
           # ÁREA DE ENTRADA DO MAGNET LINK
           ================================================================= */
        .input-area {
            padding: 20px;
            border-top: 1px solid var(--bg-dark);
        }

        .input-area h2 {
            margin-bottom: 15px;
            font-size: 1.5em;
            color: var(--primary);
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .input-group input[type="text"] {
            flex-grow: 1;
            padding: 10px 15px;
            border: 2px solid var(--bg-light);
            border-radius: 8px;
            background-color: var(--bg-dark);
            color: var(--text-light);
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-group input[type="text"]:focus {
            outline: none;
            border-color: var(--blue-accent);
        }

        .input-group button {
            background-color: var(--blue-accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 700;
            transition: background-color 0.3s, transform 0.1s;
        }

        .input-group button:hover {
            background-color: #0091ea;
        }

        .input-group button:active {
            transform: scale(0.98);
        }

        /* =================================================================
           # DETALHES DO METADADOS (NOVO)
           ================================================================= */
        .metadata-box {
            background-color: var(--bg-dark);
            border: 1px solid var(--bg-light);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px; /* Limita a altura para listas grandes */
            overflow-y: auto; /* Adiciona scroll se necessário */
        }
        .metadata-box h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1em;
            border-bottom: 1px dashed var(--bg-light);
            padding-bottom: 5px;
        }
        .metadata-box p {
            margin: 5px 0;
            font-size: 0.9em;
            color: var(--text-muted);
        }
        .metadata-box span {
            color: var(--text-light);
            font-weight: 500;
            word-break: break-all; /* Garante que nomes longos não quebrem o layout */
        }
        .metadata-box ul {
            list-style: none;
            padding-left: 0;
            margin-top: 5px;
        }
        .metadata-box li {
            font-size: 0.85em;
            color: var(--text-muted);
            line-height: 1.4;
            word-break: break-all;
        }


        /* =================================================================
           # MENSAGENS DE FEEDBACK
           ================================================================= */
        #statusMessage, #loadingIndicator {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            display: none;
        }

        #statusMessage {
            background-color: rgba(255, 61, 0, 0.1);
            color: var(--secondary);
        }

        #loadingIndicator {
            background-color: rgba(0, 230, 118, 0.1);
            color: var(--primary);
        }

        /* Loader Spinner */
        .loader {
            border: 4px solid var(--bg-light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div class="player-container">
        
        <div id="videoWrapper" class="video-wrapper">
            <!-- Elemento de vídeo nativo, será preenchido pelo WebTorrent -->
            <video id="nativeVideo" poster="https://placehold.co/900x506/1e1e1e/8a8a8a?text=Cole+um+Magnet+Link+e+Clique+em+Carregar"></video>

            <!-- Controles Personalizados -->
            <div id="controls" class="controls">
                
                <!-- Barra de Progresso -->
                <div id="progressBarContainer" class="progress-bar-container">
                    <div id="progressBar" class="progress-bar"></div>
                </div>

                <!-- Controles Inferiores -->
                <div class="controls-bottom">
                    
                    <div class="controls-left">
                        <button id="playPauseBtn" class="control-btn" aria-label="Reproduzir/Pausar">
                            <i class="material-icons">play_arrow</i>
                        </button>

                        <div class="volume-control">
                            <button id="muteBtn" class="control-btn" aria-label="Mudo">
                                <i class="material-icons">volume_up</i>
                            </button>
                            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1" aria-label="Volume">
                        </div>

                        <span id="timeDisplay" class="time-display">0:00 / 0:00</span>
                        
                        <!-- Status do Torrent (Peers, Velocidade) -->
                        <div id="torrent-status">
                            <!-- Preenchido pelo JS -->
                        </div>
                    </div>
                    
                    <div class="controls-right">
                        <button id="fullscreenBtn" class="control-btn" aria-label="Tela Cheia">
                            <i class="material-icons">fullscreen</i>
                        </button>
                    </div>

                </div>
            </div>
        </div>

        <!-- Área de Entrada do Magnet Link -->
        <div class="input-area">
            <h2>Carregar Conteúdo via Magnet Link</h2>
            <div class="input-group">
                <input type="text" id="magnetLinkInput" placeholder="Cole o Magnet Link aqui..." value="" aria-label="Campo de entrada do Magnet Link">
                <button id="loadBtn">Carregar</button>
            </div>
            
            <div id="loadingIndicator">
                <div class="loader"></div> 
                Buscando metadados... Conectando aos peers...
            </div>

            <!-- NOVO: DETALHES DO TORRENT -->
            <div id="metadata-details" class="metadata-box" style="display: none;">
                <h4>Detalhes do Conteúdo</h4>
                <p>Nome: <span id="metadata-name"></span></p>
                <p>Tamanho Total: <span id="metadata-size"></span></p>
                <p>Arquivos Encontrados (Vídeo Principal em <span>Negrito</span>):</p>
                <ul id="metadata-files"></ul>
            </div>
            <!-- FIM NOVO -->

            <div id="statusMessage"></div>
        </div>

    </div>

    <script type="text/javascript">
        // =================================================================
        // # VARIÁVEIS GLOBAIS
        // =================================================================
        let client;
        let currentTorrent = null;

        const nativeVideo = document.getElementById('nativeVideo');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const playPauseIcon = playPauseBtn.querySelector('.material-icons');
        const muteBtn = document.getElementById('muteBtn');
        const muteIcon = muteBtn.querySelector('.material-icons');
        const volumeSlider = document.getElementById('volumeSlider');
        const timeDisplay = document.getElementById('timeDisplay');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const videoWrapper = document.getElementById('videoWrapper');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const progressBar = document.getElementById('progressBar');
        const magnetLinkInput = document.getElementById('magnetLinkInput');
        const loadBtn = document.getElementById('loadBtn');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const statusMessage = document.getElementById('statusMessage');
        const controls = document.getElementById('controls');
        const torrentStatus = document.getElementById('torrent-status'); 
        
        // NOVO: Elementos de metadados
        const metadataDetails = document.getElementById('metadata-details');
        const metadataName = document.getElementById('metadata-name');
        const metadataSize = document.getElementById('metadata-size');
        const metadataFiles = document.getElementById('metadata-files');


        // =================================================================
        // # FUNÇÕES DE UTILIDADE
        // =================================================================

        /**
         * Formata segundos para o formato MM:SS ou HH:MM:SS
         * @param {number} time - Tempo em segundos.
         * @returns {string} Tempo formatado.
         */
        function formatTime(time) {
            const h = Math.floor(time / 3600);
            const m = Math.floor((time % 3600) / 60);
            const s = Math.floor(time % 60);
            const pad = (num) => String(num).padStart(2, '0');
            
            if (h > 0) {
                return `${h}:${pad(m)}:${pad(s)}`;
            } else {
                return `${pad(m)}:${pad(s)}`;
            }
        }

        /**
         * Formata bytes para o formato B/KB/MB/GB
         * @param {number} bytes - Tamanho ou taxa em bytes.
         * @returns {string} String formatada.
         */
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        /**
         * Exibe uma mensagem de status temporária.
         * @param {string} message - A mensagem a ser exibida.
         * @param {boolean} isError - Se a mensagem é um erro (usa cor secundária).
         */
        function showStatus(message, isError = false) {
            statusMessage.textContent = message;
            statusMessage.style.display = 'block';
            statusMessage.style.color = isError ? 'var(--secondary)' : 'var(--primary)';
            statusMessage.style.backgroundColor = isError ? 'rgba(255, 61, 0, 0.1)' : 'rgba(0, 230, 118, 0.1)';
            loadingIndicator.style.display = 'none';

            // Oculta a mensagem após 5 segundos
            setTimeout(() => {
                statusMessage.style.display = 'none';
                statusMessage.textContent = '';
            }, 5000);
        }

        /**
         * Limpa todos os displays de status e metadados.
         */
        function clearStatusDisplays() {
            loadingIndicator.style.display = 'none';
            statusMessage.style.display = 'none';
            metadataDetails.style.display = 'none';
            torrentStatus.innerHTML = '';
        }

        // =================================================================
        // # FUNÇÕES DO PLAYER
        // =================================================================

        /**
         * Alterna entre reproduzir e pausar o vídeo.
         */
        function togglePlay() {
            if (nativeVideo.paused) {
                nativeVideo.play();
                playPauseIcon.textContent = 'pause';
            } else {
                nativeVideo.pause();
                playPauseIcon.textContent = 'play_arrow';
            }
        }

        /**
         * Atualiza a exibição de tempo e a barra de progresso.
         */
        function updateTimeDisplay() {
            const currentTime = nativeVideo.currentTime;
            const duration = nativeVideo.duration || 0;

            if (isFinite(duration) && duration > 0) {
                timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
                progressBar.style.width = `${(currentTime / duration) * 100}%`;
            } else {
                timeDisplay.textContent = `${formatTime(currentTime)} / --:--`;
                progressBar.style.width = '0%';
            }
        }

        /**
         * Busca um novo tempo relativo.
         * @param {number} seconds - Número de segundos para avançar ou retroceder.
         */
        function seekRelative(seconds) {
            nativeVideo.currentTime += seconds;
        }

        /**
         * Define o volume e atualiza o ícone de mudo.
         * @param {number} newVolume - O novo volume (0.0 a 1.0).
         */
        function setVolume(newVolume) {
            nativeVideo.volume = newVolume;
            if (newVolume === 0) {
                muteIcon.textContent = 'volume_off';
            } else if (newVolume < 0.5) {
                muteIcon.textContent = 'volume_down';
            } else {
                muteIcon.textContent = 'volume_up';
            }
        }

        /**
         * Alterna o estado de mudo.
         */
        function toggleMute() {
            if (nativeVideo.volume > 0) {
                nativeVideo.volume = 0;
                volumeSlider.value = 0;
            } else {
                const savedVolume = parseFloat(volumeSlider.dataset.lastVolume) || 0.5;
                nativeVideo.volume = savedVolume;
                volumeSlider.value = savedVolume;
            }
            setVolume(nativeVideo.volume);
        }
        
        /**
         * Alterna o modo de tela cheia.
         */
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                videoWrapper.requestFullscreen().catch(err => {
                    console.error(`Erro ao tentar entrar em tela cheia: ${err.message}`);
                    showStatus("O navegador bloqueou o modo de tela cheia.", true);
                });
            } else {
                document.exitFullscreen();
            }
        }
        
        // =================================================================
        // # FUNÇÕES DE TORRENT (WEB TORRENT)
        // =================================================================

        /**
         * Cria o cliente WebTorrent se ainda não existir.
         */
        function getWebTorrentClient() {
            if (!client) {
                client = new WebTorrent();
                client.on('error', (err) => {
                    console.error('WebTorrent Client Error:', err);
                    showStatus(`Erro no cliente WebTorrent: ${err.message}`, true);
                });
            }
            return client;
        }

        /**
         * Função para renderizar o vídeo principal após a obtenção dos metadados.
         * @param {object} file - O arquivo de vídeo principal.
         * @param {object} torrent - O objeto WebTorrent.
         */
        function renderVideo(file, torrent) {
            file.renderTo(nativeVideo, {
                autoplay: true 
            }, (err, elem) => {
                if (err) {
                    console.error('Erro ao renderizar arquivo:', err);
                    clearStatusDisplays();
                    showStatus(`Erro ao reproduzir o vídeo: ${err.message}`, true);
                    torrent.destroy();
                    currentTorrent = null;
                    return;
                }

                console.log('Vídeo carregado e pronto para reprodução.');
                clearStatusDisplays();
                // Apenas mostra uma breve notificação de sucesso
                showStatus(`Streaming iniciado para "${file.name}".`, false); 
                controls.classList.add('active'); 
                playPauseIcon.textContent = 'pause';
            });
        }


        /**
         * Inicia o carregamento de um magnet link e a busca por metadados.
         */
        function loadMagnetLink() {
            const magnetLink = magnetLinkInput.value.trim();
            
            if (!magnetLink) {
                showStatus("Por favor, insira um Magnet Link válido.", true);
                return;
            }
            
            if (currentTorrent) {
                currentTorrent.destroy(() => console.log('Torrent anterior destruído.'));
            }
            
            // Prepara a UI para carregamento
            clearStatusDisplays();
            loadingIndicator.style.display = 'flex';
            nativeVideo.removeAttribute('src');
            nativeVideo.load();
            nativeVideo.pause();
            
            // 3. Adiciona o novo magnet link
            client = getWebTorrentClient();
            currentTorrent = client.add(magnetLink, (torrent) => {
                
                // O WebTorrent emite 'ready' quando os metadados são totalmente baixados
                torrent.on('ready', () => {
                    
                    const totalSize = formatBytes(torrent.length);
                    const videoExtensions = ['.mp4', '.webm', '.ogg', '.mkv'];
                    // Tenta encontrar o maior arquivo de vídeo
                    let videoFile = torrent.files
                        .filter(f => videoExtensions.some(ext => f.name.toLowerCase().endsWith(ext)))
                        .sort((a, b) => b.length - a.length)[0];

                    // Se não encontrar um vídeo, pega o primeiro arquivo grande para mostrar
                    if (!videoFile && torrent.files.length > 0) {
                        videoFile = torrent.files[0];
                    }

                    // Preenche os detalhes na área de metadados
                    metadataName.textContent = torrent.name || 'Nome Desconhecido';
                    metadataSize.textContent = totalSize;
                    
                    metadataFiles.innerHTML = ''; // Limpa lista
                    torrent.files.forEach(file => {
                        const li = document.createElement('li');
                        const fileSize = formatBytes(file.length);
                        
                        if (file === videoFile) {
                            li.innerHTML = `<strong>${file.name}</strong> (${fileSize}) - <em>(Vídeo principal detectado)</em>`;
                        } else {
                            li.textContent = `${file.name} (${fileSize})`;
                        }
                        metadataFiles.appendChild(li);
                    });

                    metadataDetails.style.display = 'block'; // Mostra os detalhes
                    loadingIndicator.style.display = 'none';

                    if (videoFile) {
                        // Inicia o streaming após mostrar os metadados
                        renderVideo(videoFile, torrent);
                    } else {
                        showStatus("Nenhum arquivo de vídeo suportado encontrado. Arquivos listados acima.", true);
                        torrent.destroy();
                        currentTorrent = null;
                        controls.classList.remove('active');
                    }
                });
                
                // Configura a atualização de status/peers
                torrent.on('wire', () => updateTorrentStatus()); 
                torrent.on('download', () => updateTorrentStatus()); 
                setTimeout(updateTorrentStatus, 1000); // Atualização inicial
                
            });
            
            // Lida com erro de conexão inicial ou link inválido
            client.once('error', (err) => {
                // Se o erro ocorrer antes do torrent ser adicionado/pronto
                clearStatusDisplays();
                showStatus(`Erro ao processar o link: ${err.message}. Tente novamente.`, true);
                if (currentTorrent) currentTorrent.destroy();
                currentTorrent = null;
                // Reconfigura o cliente (limpa listeners de erro)
                getWebTorrentClient(); 
            });
        }
        
        /**
         * Atualiza a exibição de download, upload e peers (Seeds).
         */
        function updateTorrentStatus() {
            if (!currentTorrent) return;

            const downloadSpeed = formatBytes(currentTorrent.downloadSpeed) + '/s';
            const uploadSpeed = formatBytes(currentTorrent.uploadSpeed) + '/s';
            const numPeers = currentTorrent.numPeers;
            
            const statusHTML = `
                <div class="status-item" title="Semeadores e Baixadores Conectados">
                    <i class="material-icons">people</i>
                    <span>${numPeers} Peers</span>
                </div>
                <div class="status-item" title="Taxa de Download">
                    <i class="material-icons">download</i>
                    <span>${downloadSpeed}</span>
                </div>
                <div class="status-item" title="Taxa de Upload">
                    <i class="material-icons">upload</i>
                    <span>${uploadSpeed}</span>
                </div>
            `;
            
            torrentStatus.innerHTML = statusHTML;
        }


        // =================================================================
        // # INICIALIZAÇÃO E EVENT LISTENERS
        // =================================================================
        
        window.onload = function() {
            client = getWebTorrentClient();
            
            // 1. Configuração Inicial do Vídeo
            nativeVideo.volume = 1.0;
            
            // 2. Eventos de UI do Player
            playPauseBtn.addEventListener('click', togglePlay);
            muteBtn.addEventListener('click', toggleMute);

            volumeSlider.addEventListener('input', (e) => {
                const newVolume = parseFloat(e.target.value);
                setVolume(newVolume);
                if (newVolume > 0) {
                    volumeSlider.dataset.lastVolume = newVolume; 
                }
            });
            
            fullscreenBtn.addEventListener('click', toggleFullscreen);

            progressBarContainer.addEventListener('click', (e) => {
                if (nativeVideo.duration && isFinite(nativeVideo.duration)) {
                    const rect = progressBarContainer.getBoundingClientRect();
                    const clickX = e.clientX - rect.left;
                    const newTime = (clickX / rect.width) * nativeVideo.duration;
                    nativeVideo.currentTime = newTime;
                    updateTimeDisplay();
                }
            });

            // 3. Eventos de Mídia (Video nativo)
            nativeVideo.addEventListener('timeupdate', updateTimeDisplay);
            nativeVideo.addEventListener('loadedmetadata', updateTimeDisplay);
            nativeVideo.addEventListener('durationchange', updateTimeDisplay);
            nativeVideo.addEventListener('play', () => playPauseIcon.textContent = 'pause');
            nativeVideo.addEventListener('pause', () => playPauseIcon.textContent = 'play_arrow');
            nativeVideo.addEventListener('volumechange', () => setVolume(nativeVideo.volume));
            
            // 4. Eventos de Tela Cheia
            document.addEventListener('fullscreenchange', () => {
                const isFullscreen = document.fullscreenElement === videoWrapper;
                fullscreenBtn.querySelector('.material-icons').textContent = isFullscreen ? 'fullscreen_exit' : 'fullscreen';
                if (isFullscreen) {
                    controls.classList.add('active');
                } else {
                    controls.classList.remove('active');
                }
            });

            // 5. Eventos de Carregamento (Input)
            loadBtn.addEventListener('click', loadMagnetLink);
            magnetLinkInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    loadMagnetLink();
                }
            });
            
            // 6. Atalhos de teclado
            document.addEventListener('keydown', (e) => {
                const isInputFocused = document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA';
                if (isInputFocused) return;
                switch (e.key) {
                    case ' ': case 'k': e.preventDefault(); togglePlay(); break;
                    case 'j': e.preventDefault(); seekRelative(-10); break;
                    case 'l': e.preventDefault(); seekRelative(10); break;
                    case 'm': e.preventDefault(); toggleMute(); break;
                    case 'f': e.preventDefault(); toggleFullscreen(); break;
                    case 'ArrowUp': e.preventDefault(); const newVolUp = Math.min(1, nativeVideo.volume + 0.05); setVolume(newVolUp); volumeSlider.value = newVolUp; break;
                    case 'ArrowDown': e.preventDefault(); const newVolDown = Math.max(0, nativeVideo.volume - 0.05); setVolume(newVolDown); volumeSlider.value = newVolDown; break;
                    case 'ArrowLeft': e.preventDefault(); seekRelative(-5); break;
                    case 'ArrowRight': e.preventDefault(); seekRelative(5); break;
                    default: if (e.key >= '0' && e.key <= '9') { e.preventDefault(); const time = (nativeVideo.duration / 10) * parseInt(e.key); nativeVideo.currentTime = time; } break;
                }
            });
        }
    </script>
</body>
</html>
